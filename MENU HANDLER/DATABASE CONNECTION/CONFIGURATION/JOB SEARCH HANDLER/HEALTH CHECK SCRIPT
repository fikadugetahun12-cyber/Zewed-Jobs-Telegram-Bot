#!/usr/bin/env python3
import requests
import mysql.connector
import os
from dotenv import load_dotenv

load_dotenv('.env.production')

def check_database():
    try:
        conn = mysql.connector.connect(
            host=os.getenv("DB_HOST"),
            database=os.getenv("DB_NAME"),
            user=os.getenv("DB_USER"),
            password=os.getenv("DB_PASS")
        )
        conn.close()
        return True
    except:
        return False

def check_bot():
    try:
        response = requests.get(f"https://api.telegram.org/bot{os.getenv('BOT_TOKEN')}/getMe", timeout=5)
        return response.status_code == 200
    except:
        return False

def check_payments():
    # Check payment gateways
    gateways = ['telebirr', 'stripe']  # Add your gateways
    results = {}
    
    # Add gateway-specific checks
    # ...
    
    return all(results.values())

if __name__ == "__main__":
    print("üîç Zewed Jobs Health Check")
    print("="*30)
    
    db_status = "‚úÖ" if check_database() else "‚ùå"
    bot_status = "‚úÖ" if check_bot() else "‚ùå"
    
    print(f"Database: {db_status}")
    print(f"Bot API: {bot_status}")
    
    if not check_database() or not check_bot():
        print("\n‚ö†Ô∏è  Issues detected! Sending alert...")
        # Send alert to Telegram admin
        # requests.post(f"https://api.telegram.org/bot{os.getenv('BOT_TOKEN')}/sendMessage", 
        #              data={'chat_id': os.getenv('ADMIN_IDS').split(',')[0], 
        #                    'text': 'üö® Health check failed!'})
